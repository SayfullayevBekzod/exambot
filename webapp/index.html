<!DOCTYPE html>
<html lang="uz">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>IELTS Preparation</title>
    <link rel="stylesheet" href="style.css">
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&display=swap"
        rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>

<body>
    <!-- Animated Background -->
    <div class="bg-animation">
        <div class="bg-orb orb-1"></div>
        <div class="bg-orb orb-2"></div>
        <div class="bg-orb orb-3"></div>
    </div>

    <!-- Loading Screen -->
    <div id="loading" class="loading-screen">
        <div class="loader-ring">
            <div class="loader-inner"></div>
        </div>
        <p class="loader-text">IELTS Prep</p>
        <p class="loader-sub">Yuklanmoqda...</p>
    </div>

    <!-- App Container -->
    <div id="app" class="app hidden">
        <!-- Header -->
        <header class="header">
            <div class="header-content">
                <div class="header-left">
                    <div class="logo-icon">ğŸ“</div>
                    <div>
                        <h1>IELTS Prep</h1>
                        <span class="header-sub">Smart Learning Platform</span>
                    </div>
                </div>
                <div class="user-info">
                    <div class="user-avatar" id="userAvatar">U</div>
                    <span id="premiumBadge" class="premium-badge hidden">ğŸ‘‘</span>
                </div>
            </div>
        </header>

        <!-- Pages Container -->
        <div class="pages-container">

            <!-- Quiz Tab -->
            <div id="tab-quiz" class="tab-content active">
                <!-- Subject Selection -->
                <div id="quizSubjects" class="section fade-in">
                    <h2 class="section-title">ğŸ“š Bo'limni tanlang</h2>
                    <div id="subjectsList" class="subjects-grid"></div>

                    <div class="daily-challenge" onclick="startDailyChallenge()">
                        <div class="dc-icon">âš¡</div>
                        <div class="dc-info">
                            <div class="dc-title">Kunlik Challenge</div>
                            <div class="dc-sub">Barcha bo'limlardan 10 ta savol</div>
                        </div>
                        <div class="dc-arrow">â†’</div>
                    </div>

                    <div class="cbt-simulator-promo" onclick="openCBTSimulator()">
                        <div class="csp-icon">ğŸ–¥ï¸</div>
                        <div class="csp-info">
                            <div class="csp-title">IELTS CBT Simulator</div>
                            <div class="csp-sub">Haqiqiy imtihon ko'rinishida topshirish</div>
                        </div>
                        <div class="csp-badge">New</div>
                    </div>
                </div>

                <!-- Difficulty Selection -->
                <div id="quizDifficulty" class="section hidden fade-in">
                    <h2 class="section-title" id="diffSubjectName">ğŸ“š Bo'lim</h2>
                    <p class="section-desc">Qiyinlik darajasini tanlang:</p>
                    <div class="difficulty-grid">
                        <div class="diff-card easy" onclick="selectDifficulty(1)">
                            <div class="diff-emoji">ğŸŸ¢</div>
                            <div class="diff-name">Oson</div>
                            <div class="diff-desc">Boshlang'ich savolllar</div>
                        </div>
                        <div class="diff-card medium" onclick="selectDifficulty(2)">
                            <div class="diff-emoji">ğŸŸ¡</div>
                            <div class="diff-name">O'rta</div>
                            <div class="diff-desc">Standart savolllar</div>
                        </div>
                        <div class="diff-card hard" onclick="selectDifficulty(3)">
                            <div class="diff-emoji">ğŸ”´</div>
                            <div class="diff-name">Qiyin</div>
                            <div class="diff-desc">Murakkab savolllar</div>
                        </div>
                        <div class="diff-card all" onclick="selectDifficulty(0)">
                            <div class="diff-emoji">ğŸŒˆ</div>
                            <div class="diff-name">Aralash</div>
                            <div class="diff-desc">Barcha darajalar</div>
                        </div>
                    </div>
                    <button class="btn btn-ghost" onclick="backToSubjects()">â† Orqaga</button>
                </div>

                <!-- Quiz Active -->
                <div id="quizActive" class="section hidden">
                    <div class="quiz-header">
                        <div class="quiz-top-bar">
                            <button class="btn-icon" onclick="quitQuiz()">âœ•</button>
                            <span id="quizCounter" class="quiz-counter">1/10</span>
                            <span id="quizScore" class="quiz-score-badge">âœ… 0</span>
                        </div>
                        <div class="progress-bar">
                            <div id="quizProgressBar" class="progress-fill"></div>
                        </div>
                        <div class="timer-bar">
                            <div id="timerBar" class="timer-fill"></div>
                        </div>
                    </div>
                    <div class="quiz-body fade-in">
                        <div id="quizDiffBadge" class="diff-badge">ğŸŸ¢ Oson</div>
                        <div id="quizQuestion" class="quiz-question"></div>
                        <div id="quizOptions" class="quiz-options"></div>
                    </div>
                </div>

                <!-- Quiz Result -->
                <div id="quizResult" class="section hidden">
                    <div class="result-card fade-in">
                        <canvas id="confettiCanvas" class="confetti-canvas"></canvas>
                        <div id="resultEmoji" class="result-emoji">ğŸ†</div>
                        <h2 id="resultTitle" class="result-title">Ajoyib!</h2>
                        <div class="band-gauge">
                            <svg viewBox="0 0 200 120" class="gauge-svg">
                                <path d="M 20 100 A 80 80 0 0 1 180 100" fill="none" stroke="rgba(255,255,255,0.08)"
                                    stroke-width="12" stroke-linecap="round" />
                                <path id="gaugeArc" d="M 20 100 A 80 80 0 0 1 180 100" fill="none"
                                    stroke="url(#gaugeGrad)" stroke-width="12" stroke-linecap="round"
                                    stroke-dasharray="251" stroke-dashoffset="251" />
                                <defs>
                                    <linearGradient id="gaugeGrad" x1="0%" y1="0%" x2="100%">
                                        <stop offset="0%" stop-color="#ef4444" />
                                        <stop offset="50%" stop-color="#f59e0b" />
                                        <stop offset="100%" stop-color="#10b981" />
                                    </linearGradient>
                                </defs>
                            </svg>
                            <div class="gauge-value">
                                <span id="resultBand" class="gauge-band">7.0</span>
                                <span class="gauge-label">Band</span>
                            </div>
                        </div>
                        <div class="result-stats">
                            <div class="rs-item">
                                <div class="rs-val" id="resultCorrect">8</div>
                                <div class="rs-label">To'g'ri</div>
                            </div>
                            <div class="rs-divider"></div>
                            <div class="rs-item">
                                <div class="rs-val" id="resultWrong">2</div>
                                <div class="rs-label">Xato</div>
                            </div>
                            <div class="rs-divider"></div>
                            <div class="rs-item">
                                <div class="rs-val" id="resultPercent">80%</div>
                                <div class="rs-label">Aniqlik</div>
                            </div>
                        </div>
                        <div class="result-actions">
                            <button class="btn btn-primary btn-lg" onclick="resetQuiz()">ğŸ”„ Qayta boshlash</button>
                            <button class="btn btn-glass" onclick="showReview()">ğŸ“‹ Javoblarni ko'rish</button>
                        </div>
                    </div>
                </div>

                <!-- Quiz Review -->
                <div id="quizReview" class="section hidden">
                    <div class="review-header">
                        <h2 class="section-title">ğŸ“‹ Javoblar tahlili</h2>
                        <button class="btn btn-ghost" onclick="hideReview()">â† Orqaga</button>
                    </div>
                    <div id="reviewList" class="review-list"></div>
                </div>
            </div>

            <!-- Flashcards Tab -->
            <div id="tab-flashcards" class="tab-content hidden">
                <div id="flashcardView" class="section fade-in">
                    <h2 class="section-title">ğŸ—‚ï¸ Flashcards</h2>
                    <div id="flashcardStats" class="fc-stats"></div>

                    <div class="fc-counter" id="fcCounter">1 / 0</div>

                    <div class="fc-swipe-container" id="fcSwipeArea">
                        <div id="flashcard" class="flashcard" onclick="flipCard()">
                            <div class="flashcard-inner" id="flashcardInner">
                                <div class="flashcard-front">
                                    <div class="fc-lang-badge">ğŸ‡¬ğŸ‡§ English</div>
                                    <span id="fcFront" class="fc-text">Loading...</span>
                                    <small class="fc-hint">ğŸ‘† Ochish uchun bosing</small>
                                </div>
                                <div class="flashcard-back">
                                    <div class="fc-lang-badge">ğŸ‡ºğŸ‡¿ O'zbekcha</div>
                                    <span id="fcBack" class="fc-text">Loading...</span>
                                    <p id="fcExample" class="fc-example"></p>
                                </div>
                            </div>
                        </div>
                        <div class="swipe-hint">
                            <span>â† Bilmadim</span>
                            <span>Bildim â†’</span>
                        </div>
                    </div>

                    <div class="fc-actions">
                        <button class="btn btn-danger btn-round" onclick="flashcardResponse('didnt')">
                            <span class="btn-icon-inner">âœ•</span>
                            <span>Bilmadim</span>
                        </button>
                        <button class="btn btn-secondary btn-round" onclick="loadFlashcard()">
                            <span class="btn-icon-inner">â­</span>
                            <span>O'tkazish</span>
                        </button>
                        <button class="btn btn-success btn-round" onclick="flashcardResponse('knew')">
                            <span class="btn-icon-inner">âœ“</span>
                            <span>Bildim</span>
                        </button>
                    </div>
                </div>
            </div>

            <!-- Stats Tab -->
            <div id="tab-stats" class="tab-content hidden">
                <div class="section fade-in">
                    <h2 class="section-title">ğŸ“Š Natijalarim</h2>
                    <div id="statsOverview" class="stats-overview">
                        <div class="stat-card stat-glow-1">
                            <div class="stat-icon">ğŸ“</div>
                            <div class="stat-value" id="statTests">0</div>
                            <div class="stat-label">Testlar</div>
                        </div>
                        <div class="stat-card stat-glow-2">
                            <div class="stat-icon">ğŸ“Š</div>
                            <div class="stat-value" id="statAvg">0%</div>
                            <div class="stat-label">O'rtacha</div>
                        </div>
                        <div class="stat-card stat-glow-3">
                            <div class="stat-icon">ğŸ¯</div>
                            <div class="stat-value" id="statBand">0</div>
                            <div class="stat-label">Band</div>
                        </div>
                        <div class="stat-card stat-glow-4">
                            <div class="stat-icon">ğŸ”¥</div>
                            <div class="stat-value" id="statStreak">0</div>
                            <div class="stat-label">Streak</div>
                        </div>
                    </div>

                    <!-- Interactive Charts -->
                    <div class="stats-charts-grid">
                        <div class="chart-container-glass">
                            <h3 class="chart-title">ğŸ“ˆ Band Score Trend</h3>
                            <canvas id="trendChart"></canvas>
                        </div>
                        <div class="chart-container-glass">
                            <h3 class="chart-title">ğŸ¯ Skill Breakdown</h3>
                            <canvas id="radarChart"></canvas>
                        </div>
                    </div>

                    <!-- Subject Performance -->
                    <h3 class="section-subtitle">ğŸ“ˆ Bo'limlar bo'yicha</h3>
                    <div id="subjectBars" class="subject-bars"></div>

                    <h3 class="section-subtitle">ğŸ• Oxirgi natijalar</h3>
                    <div id="statsHistory" class="stats-history"></div>

                    <h3 class="section-subtitle">ğŸ† Reyting</h3>
                    <div id="leaderboard" class="leaderboard"></div>
                </div>
            </div>

            <!-- Premium Tab -->
            <div id="tab-premium" class="tab-content hidden">
                <div class="section fade-in">
                    <div class="premium-hero">
                        <div class="premium-glow"></div>
                        <div class="premium-icon-wrap">
                            <div class="premium-icon">ğŸ‘‘</div>
                            <div class="premium-sparkles">
                                <span>âœ¨</span><span>âœ¨</span><span>âœ¨</span>
                            </div>
                        </div>
                        <h2>Premium Obuna</h2>
                        <p>IELTS tayyorlanishda keyingi darajaga chiqing!</p>
                    </div>

                    <div class="premium-features">
                        <div class="pf-item"><span class="pf-icon">ğŸ§</span><span>Audio Listening</span></div>
                        <div class="pf-item"><span class="pf-icon">ğŸ“Š</span><span>PDF Sertifikat</span></div>
                        <div class="pf-item"><span class="pf-icon">ğŸ§ </span><span>Spaced Repetition</span></div>
                        <div class="pf-item"><span class="pf-icon">ğŸ—‚ï¸</span><span>Flashcards</span></div>
                        <div class="pf-item"><span class="pf-icon">ğŸ“…</span><span>Study Plan</span></div>
                        <div class="pf-item"><span class="pf-icon">ğŸ®</span><span>Speed Round</span></div>
                        <div class="pf-item pf-full"><span class="pf-icon">ğŸŒ</span><span>Tarjima rejimi</span></div>
                    </div>

                    <div class="premium-plans">
                        <div class="plan-card" onclick="buyPremium('1_month')">
                            <div class="plan-duration">1 oy</div>
                            <div class="plan-price">29 900 <small>so'm</small></div>
                            <div class="plan-per">~1 000 so'm/kun</div>
                        </div>
                        <div class="plan-card popular" onclick="buyPremium('3_months')">
                            <div class="plan-badge">ğŸ”¥ Eng ommabop</div>
                            <div class="plan-duration">3 oy</div>
                            <div class="plan-price">69 900 <small>so'm</small></div>
                            <div class="plan-per">~780 so'm/kun</div>
                            <div class="plan-save">22% tejash</div>
                        </div>
                        <div class="plan-card" onclick="buyPremium('6_months')">
                            <div class="plan-duration">6 oy</div>
                            <div class="plan-price">119 900 <small>so'm</small></div>
                            <div class="plan-per">~660 so'm/kun</div>
                            <div class="plan-save">33% tejash</div>
                        </div>
                    </div>

                    <div class="payment-info">
                        <div class="pi-item">ğŸ’³ Click orqali to'lov</div>
                        <div class="pi-item">ğŸ”’ Xavfsiz tranzaksiya</div>
                        <div class="pi-item">â†©ï¸ 3 kun ichida qaytarish</div>
                    </div>

                    <div id="premiumStatus" class="premium-status hidden">
                        <div class="ps-icon">âœ…</div>
                        <div class="ps-active">Premium faol!</div>
                        <div id="premiumExpiry" class="ps-expiry"></div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Tab Navigation (Bottom) -->
        <nav class="tab-nav">
            <button class="tab-btn active" data-tab="quiz" onclick="switchTab('quiz')">
                <span class="tab-icon">ğŸ“</span>
                <span class="tab-label">Test</span>
                <span class="tab-indicator"></span>
            </button>
            <button class="tab-btn" data-tab="flashcards" onclick="switchTab('flashcards')">
                <span class="tab-icon">ğŸ—‚ï¸</span>
                <span class="tab-label">Kartalar</span>
                <span class="tab-indicator"></span>
            </button>
            <button class="tab-btn" data-tab="stats" onclick="switchTab('stats')">
                <span class="tab-icon">ğŸ“Š</span>
                <span class="tab-label">Natija</span>
                <span class="tab-indicator"></span>
            </button>
            <button class="tab-btn" data-tab="premium" onclick="switchTab('premium')">
                <span class="tab-icon">ğŸ‘‘</span>
                <span class="tab-label">Premium</span>
                <span class="tab-indicator"></span>
            </button>
        </nav>
    </div>

    <!-- Toast -->
    <div id="toast" class="toast">
        <span id="toastIcon" class="toast-icon">âœ…</span>
        <span id="toastMsg" class="toast-msg"></span>
    </div>

    <!-- CBT Simulator Overlay -->
    <div id="cbtOverlay" class="cbt-overlay hidden">
        <div class="cbt-header">
            <div class="cbt-header-left">
                <span class="cbt-logo">ğŸ“ CBT Simulator</span>
                <span id="cbtSubject" class="cbt-sub-title">Reading Practice</span>
            </div>
            <div class="cbt-header-center">
                <div class="cbt-timer" id="cbtTimer">60:00</div>
            </div>
            <div class="cbt-header-right">
                <button class="btn btn-danger btn-sm" onclick="closeCBTSimulator()">Exit</button>
            </div>
        </div>

        <div class="cbt-workspace">
            <div class="cbt-passage-side" id="cbtPassageSide">
                <div class="cbt-passage-content" id="cbtPassageText">
                    <!-- Passage text goes here -->
                </div>
            </div>
            <div class="cbt-question-side">
                <div class="cbt-question-container" id="cbtQuestionArea">
                    <!-- Questions go here -->
                </div>
            </div>
        </div>

        <div class="cbt-footer">
            <div class="cbt-nav-pills" id="cbtNavPills">
                <!-- Question buttons 1-40 -->
            </div>
            <button class="btn btn-primary" onclick="submitCBT()">Finish & Submit</button>
        </div>
    </div>

    <script src="app.js"></script>
</body>

</html>